{% extends 'layout.html' %}
{% load edit_tags %}
{% load thumbnail %}
{% block title %}{{ event.event_name }} - Szczegóły{% endblock %}

{% block content %}

<div class="container my-5">

{% if messages %}
    {% for message in messages %}
      <div class="alert message-{{ message.tags }}" role="alert">
        {{ message }}
      </div>
    {% endfor %}
{% endif %}

  <div class="bg-light rounded shadow-sm p-4">

    <div class="d-flex flex-column flex-md-row justify-content-between 
                align-items-start align-items-md-center mb-4 text-primary">
        <h1 class="display-5 fw-bold text-break mb-3 mb-md-0" style="max-width: 100%;">{{ event.event_name }}</h1>
        {% edit_tag 'events' 'event' event.id 'bi-tools' 'Edytuj wydarzenie' %}
    </div>

    <div class="row g-4 align-items-center">

      <div class="col-lg-6 d-flex">
        <div class="bg-white border rounded shadow-sm p-3 h-100 w-100 d-flex align-items-center justify-content-center">
          <table class="table table-sm mb-0 align-middle" style="margin-bottom: 0;">
            <tbody>
              <tr>
                <th class="text fw-semibold" style="width: 40%; color: #b5895a; vertical-align: middle; text-align: center;">Autor</th>
                <td class="fw-semibold text-dark" style="vertical-align: middle; text-align: center;">{{ event.get_creator_name }}</td>
              </tr>
              <tr>
                <th class="text fw-bold" style="color: #b5895a; vertical-align: middle; text-align: center;">Data wydarzenia</th>
                <td class="fw-semibold text-dark" style="vertical-align: middle; text-align: center;">{{ event.event_date|date:"Y-m-d H:i" }}</td>
              </tr>
              <tr>
                <th class="text fw-bold" style="color: #b5895a; vertical-align: middle; text-align: center;">Miasto</th>
                <td class="fw-semibold text-dark" style="vertical-align: middle; text-align: center;">{{ event.location }}</td>
              </tr>
              <tr>
                <th class="text fw-bold" style="color: #b5895a; vertical-align: middle; text-align: center;">Zdjęcie</th>
                <td style="vertical-align: middle; text-align: center;">
                  {% if event.image %}
                    {% thumbnail event.image "320x240" crop="center" as im %}
                      <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="{{ event.event_name }}" class="img-fluid rounded shadow-sm" style="object-fit: cover;">
                    {% endthumbnail %}
                  {% else %}
                    <div class="d-flex justify-content-center align-items-center bg-secondary-subtle text-muted rounded border" style="height: 180px;">
                      Brak zdjęcia
                    </div>
                  {% endif %}
                </td>
              </tr>
              <tr>
                <th class="text fw-bold" style="color: #b5895a; vertical-align: middle; text-align: center;">Dodano</th>
                <td class="fw-semibold text-dark" style="vertical-align: middle; text-align: center;">{{ event.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
              <tr>
                <th class="text fw-bold" style="color: #b5895a; vertical-align: middle; text-align: center;">Edytowano</th>
                <td class="fw-semibold text-dark" style="vertical-align: middle; text-align: center;">{{ event.updated_at|date:"Y-m-d H:i" }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="col-lg-6 d-flex">
        <div class="bg-white border rounded shadow-sm p-3 h-100 w-100 d-flex flex-column align-items-center justify-content-center">
          <h2 class="text fw-bold mb-3" style="color: #b5895a;">Lokalizacja</h2>
          {% if event.city %}
            <div id="{{ event.event_name|slugify }}" class="rounded border border-primary w-100" style="height: 290px; max-width: 500px;"></div>
            <script>
              var map = L.map('{{ event.event_name|slugify }}').setView([
                parseFloat("{{ event.city.y }}".replace(',', '.')),
                parseFloat("{{ event.city.x }}".replace(',', '.'))
              ], 13);
              L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
              }).addTo(map);
              L.marker([
                parseFloat("{{ event.city.y }}".replace(',', '.')),
                parseFloat("{{ event.city.x }}".replace(',', '.'))
              ]).addTo(map);
            </script>
          {% else %}
            <div class="bg-secondary-subtle text-muted rounded border d-flex align-items-center justify-content-center" style="height: 330px; width: 100%; max-width: 500px;">
              Brak lokalizacji
            </div>
          {% endif %}
        </div>
      </div>

    </div>

    <div class="mt-4 bg-white border rounded shadow-sm p-4">
      <h2 class="text fw-bold" style="color: #b5895a;">Opis wydarzenia</h2>
      <p class="fs-5 text-dark fw-semibold" style="white-space: normal; word-break: break-word;">
        {{ event.description }}
      </p>
    </div>

    {% if user.is_authenticated and event.creator == user %}
      <div class="mt-4 d-flex gap-3 justify-content-center flex-wrap">
        <a href="{% url 'events:edit_event' pk=event.pk %}" class="btn btn-outline-warning">Edytuj wydarzenie</a>
        <a href="{% url 'events:delete_event' pk=event.pk %}" class="btn btn-outline-danger">Usuń wydarzenie</a>
      </div>
    {% endif %}

    <div class="mt-4 text-center">
      <a href="{% url 'events:list_event' %}" class="btn btn-outline-info">Powrót do listy</a>
    </div>

  </div>

  <section class="mt-5 bg-white border rounded shadow-sm p-4">
    <h2 class="text fw-bold" style="color: #b5895a;">Opinie:</h2>
    {% include "comments_and_ratings/rating_form.html" %}
    {% include "comments_and_ratings/comment_list.html" %}
  </section>

</div>

{% endblock %}
